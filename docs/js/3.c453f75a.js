(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"2d91":function(e,t,s){"use strict";(function(e){s("4e82"),s("e6cf"),s("ddb0"),s("5319");var n=s("cf57");const{Octokit:a}=s("1af2"),i=s("1712").to,o=s("bc3a"),l="GospelSounders",r="all-pdf-lessons-in-pdf",c="sabbathschool",g="ch1941.adh";t["a"]={name:"MainLayout",components:{},computed:{},created(){this.checkforCredentials(),this.changedLessonType()},data(){return{lessonType:"missing",pageEditorText:"",lines:[],allElements:[],leftDrawerOpen:!1,openLesson:!0,loginDialog:!1,loggedIn:!1,gkKey:null,gtKeyErrorMessage:"",allLessons:[],existingLessons:[],existings:[],lessonsToOpen:[],allLessonsToOpen:[],lessonsToOpen:[],selectedLesson:""}},methods:{getCurrentPage(){let e,t=this.$refs.pageEditor.contentWindow.document,s=t.getElementsByClassName("pf");for(let a in s){try{if(s[a].getBoundingClientRect().top>=0){e=s[a];break}}catch(n){}}return e},getPageNumber(e){let t;console.log(e);for(let s in e.classList){let n=e.classList[s];if(n.match(/pc[0-9a-z]+/)){t=n;break}}return t=t.slice(2),t},getPageAnchor(e){let t=this.$refs.pageEditor.contentWindow.document,s=t.getElementsByTagName("a");for(let n in s)if(s[n].href.split("/").slice(-1)[0]===`#pf${e}`)return s[n]},removePageAnchor(e){let t=this.getPageAnchor(this.getPageNumber(e));t.parentNode.removeChild(t)},deleteHeaders(){let e=this.getCurrentPage();e=e.children[0];let t=[];for(let n in e.children){let s=e.children[n];t.push(s)}t=t.filter((e=>{try{return e.getBoundingClientRect(),e}catch(t){return!1}})),t=t.sort(((e,t)=>{e.getBoundingClientRect().x;let s=e.getBoundingClientRect().y,n=(t.getBoundingClientRect().x,t.getBoundingClientRect().y);return s-n}));let s=t[0];s.parentNode.removeChild(s);this.getPageNumber(e);this.$refs.fabs.show()},gotoNextPage(){let e=this.getCurrentPage();e=e.children[0];let t=this.getPageNumber(e),s=this.$refs.pageEditor.contentWindow.document,n=s.getElementsByTagName("a"),a=parseInt(t,16)+1;console.log(a),a=a.toString(16);for(let o in n)try{if(n[o].href.split("/").slice(-1)[0]===`#pf${a}`){n[o].click();break}}catch(i){}},gotoPreviousPage(){let e=this.getCurrentPage();e=e.children[0];let t=this.getPageNumber(e),s=this.$refs.pageEditor.contentWindow.document,n=s.getElementsByTagName("a"),a=parseInt(t,16)-1;a=a.toString(16);for(let o in n)try{if(n[o].href.split("/").slice(-1)[0]===`#pf${a}`){n[o].click();break}}catch(i){}},deletePage(){let e=this.getCurrentPage();this.removePageAnchor(e.children[0]),e.parentNode.removeChild(e);let t=this.getPageNumber(e.children[0]),s=parseInt(t,16);setTimeout((()=>{let e=this.$refs.pageEditor.contentWindow.document,n=e.getElementsByClassName("pc");for(let l in n){let e=n[l];for(let n in e.classList){let a=e.classList[n];if(a.match(/pc[0-9a-z]+/)){if(t=parseInt(a.slice(2),16),t>s){t--;let s="pc"+t.toString(16);e.classList.remove(a),e.classList.add(s),e.parentElement.setAttribute("data-page-no",t.toString(16)),e.parentElement.id="pf"+t.toString(16)}break}}}let a=e.getElementsByTagName("a");for(let l in a)try{let e=a[l].href.split("/").slice(-1)[0];if(e.match(/#pf[0-9a-z]+/)&&(t=parseInt(e.slice(3),16),t>s)){t--;let e=a[l].getAttribute("data-dest-detail");e=JSON.parse(e),e[0]--,a[l].setAttribute("data-dest-detail",JSON.stringify(e)),a[l].href="#pf"+t.toString(16),a[l].innerHTML="page"+t}}catch(o){}e=this.$refs.pageEditor.contentWindow.document;let i=this.$refs.pageEditor.contentWindow.document.documentElement.outerHTML;this.$refs.pageEditor.srcdoc=i}),1e3)},async changedLessonType(){return this.$q.loading.show({message:"Fetching List",backgroundColor:"grey",spinner:n["a"],customClass:"loader"}),new Promise((async(e,t)=>{const s=new a({auth:this.loggedIn});let o="htmlFiles",[g,p]=await i(s.request(`GET /repos/${l}/${r}/contents/${o}`,{owner:l,repo:r,path:o}));if(this.$q.loading.hide(),g)return e(!1);let d=p.data;this.allLessons=d.map((e=>e.name.slice(2).replace(".html","")));let h=[],u=[];for(let n=1888;n<=2e3;n++)0===u.length&&u.push(n),n%10===0&&(u.push(n),h.push(u),u=[]);let m=2,f=[];for(let n in h){let e=h[n][0],t=h[n][1],s=1,a=m.toString();while(a.length<2)a=`0${a}`;for(let n=e;n<=t;n++){let i=s.toString();while(i.length<2)i=`0${i}`;f.push(`${a}.${e}-${t}/${i}.${n}`),s++}m++}let b=[];for(let n in f)b.push(`${f[n]}/01.quarter1`),b.push(`${f[n]}/02.quarter2`),b.push(`${f[n]}/03.quarter3`),b.push(`${f[n]}/04.quarter4`);if(0===this.existings.length){this.$q.loading.show({message:"Fetching List",backgroundColor:"grey",spinner:n["a"],customClass:"loader"});const e=async e=>new Promise((async t=>{let[n,a]=await i(s.request(`GET /repos/${l}/${c}/contents/${e}`,{owner:l,repo:c,path:e}));return this.$q.loading.hide(),n||1===a.data.length?t(!1):t(e)}));let t=b.map(e);[g,p]=await i(Promise.all(t)),p=p.filter((e=>!1!==e));let a=[];p.map((e=>{let t=e.split("/").slice(-2)[0].split(".").slice(-1)[0],s=e.split("/").slice(-1)[0].slice(-1);while(s.length<2)s=`0${s}`;a.push(`${t}-${s}`)})),this.existings=a}let y=this.existings;switch(this.lessonType){case"all":this.allLessonsToOpen=this.allLessons;break;case"missing":this.allLessonsToOpen=this.allLessons.filter((e=>{let t=e,s=`${t.slice(0,4)}-${e.slice(9,11)}`;return!y.includes(s)}));break;case"existing":this.openLesson=!1,this.$q.notify({type:"negative",message:"Not yet implemented"});break}}))},clearBackground(){let e=this.$refs.pageEditor.contentWindow.document;for(let n=0;n<20;n++){let t=e.getElementsByTagName("img");for(let e in t){let n=t[e];try{n.parentNode.removeChild(n)}catch(s){}}}var t=document.createElement("style");t.type="text/css",t.innerHTML="\n              .bordered{\n              border: 1px solid green;\n              }\n              ",e.getElementsByTagName("head")[0].appendChild(t),this.detectLines()},joinLines(){let e=this.$refs.pageEditor.contentWindow.document,t=e.getElementsByClassName("pf"),s=[];for(let a in t)try{let e=t[a];e=e.children[0];let n=[];for(let t in e.children){let s=e.children[t];n.push(s)}n=n.filter((e=>{try{return e.getBoundingClientRect(),e}catch(t){return!1}})),n=n.sort(((e,t)=>{e.getBoundingClientRect().x;let s=e.getBoundingClientRect().y,n=(t.getBoundingClientRect().x,t.getBoundingClientRect().y);return s-n})),n.map((e=>s.push(e)))}catch(n){}this.allElements=s},detectLines(){this.detectLines_()},detectLines_(){this.joinLines(),this.pageEditorText="";let e=this.allElements,t=[],s=[];for(let n in e){let a=e[n];if(0===s.length)s.push(a);else{let e=s[s.length-1].getBoundingClientRect(),n=e.top-e.height,i=a.getBoundingClientRect(),o=i.top-i.height,l=e.height<i.height?e.height:i.height;if(Math.abs(n-o)<.5*l)s.push(a);else{s=s.sort(((e,t)=>{let s=e.getBoundingClientRect().x,n=(e.getBoundingClientRect().y,t.getBoundingClientRect().x);t.getBoundingClientRect().y;return s-n}));let e="";for(let t in s)e+=s[t].innerHTML;s[0].innerHTML=`${e}`,this.pageEditorText+=`\n${e.replace(/<[^>]+>/g,"")}`;for(let t in s)t>0&&s[t].parentNode.removeChild(s[t]);t.push(s),s=[],s.push(a)}}this.lines=t}},detectParagraphs(){this.detectLines(),window.abc=this.lines[0],console.log(this.lines[1]),console.log(this.lines[2]),console.log(this.lines[3]),console.log(this.lines[0].getBoundingClientRect().x),console.log(this.lines[1].getBoundingClientRect().x),console.log(this.lines[2].getBoundingClientRect().x),console.log(this.lines[3].getBoundingClientRect().x),console.log(this.lines[4].getBoundingClientRect().x)},filterFn(e,t){t(""!==e?()=>{const t=e.toLowerCase();this.lessonsToOpen=this.allLessonsToOpen.filter((e=>e.toLowerCase().indexOf(t)>-1))}:()=>{this.lessonsToOpen=this.allLessonsToOpen})},logout(){window.localStorage.removeItem("adhGitKey"),this.checkforCredentials()},async saveExtractedFile(){let t=this.pageEditorText.split("\n")[1];if(parseInt(t).toString()===t){t=t;while(t.length<3)t=`0${t}`}else t=this.selectedLesson;let s=`extracted/${t}`;const n=new a({auth:this.loggedIn});let o,[r,c]=await i(n.request(`GET /repos/${l}/${g}/contents/${s}`,{owner:l,repo:g,path:s}));r||(o=c.data.sha);let p={owner:l,repo:g,path:s,message:s,content:e.from(this.pageEditorText).toString("base64")};o&&(p.sha=o),[r,c]=await i(n.request(`PUT /repos/${l}/${g}/contents/${s}`,p))},async nextOriginalFile(){if(""===this.selectedLesson)this.selectedLesson="page1";else{let e=parseInt(this.selectedLesson.replace("page",""));e++,this.selectedLesson=`page${e}`}this.onSubmitOpenLesson()},async prevOriginalFile(){if(""===this.selectedLesson)this.selectedLesson="page1";else{let e=parseInt(this.selectedLesson.replace("page",""));e--,e<1&&(e=1),this.selectedLesson=`page${e}`}this.onSubmitOpenLesson()},async onSubmitOpenLesson(){return new Promise((async(e,t)=>{new a({auth:this.loggedIn});let s=`htmlFiles/SS${this.selectedLesson}.html`,[n,c]=await i(o.get(`https://raw.githubusercontent.com/${l}/${r}/master/${s}`));if(this.openLesson=!1,n)return e(!1);c=c.data,c=c.replace(";color:transparent",";color:black"),c=c.replace("{color:transparent","{color:black"),c=c.replace(".t{",".t{border:1px solid green;"),this.$refs.pageEditor.srcdoc=c,setTimeout((()=>{this.clearBackground()}),2e3)}))},onSubmitgtKey(){window.localStorage.setItem("adhGitKey",this.gkKey),this.checkforCredentials(),this.loginDialog=!1},onResetgtKey(){},checkforCredentials(){let e=window.localStorage.getItem("adhGitKey");this.loggedIn=e},mouseOutofDrawer(e){Math.abs(e.clientX-this.$refs.drawer.width)<5&&(this.leftDrawerOpen=!1)}}}}).call(this,s("b639").Buffer)},cfda:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-layout",{attrs:{view:"hHh Lpr lFf"}},[s("q-header",{attrs:{elevated:""}},[s("q-toolbar",[s("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu"},on:{click:function(t){e.leftDrawerOpen=!e.leftDrawerOpen}}}),s("q-toolbar-title",[e._v(" Lesson Editor ")])],1)],1),s("q-drawer",{ref:"drawer",attrs:{overlay:"",bordered:"",breakpoint:500,persist:"","content-class":"bg-primary text-white"},on:{mouseout:e.mouseOutofDrawer},model:{value:e.leftDrawerOpen,callback:function(t){e.leftDrawerOpen=t},expression:"leftDrawerOpen"}},[s("q-list",[e.loggedIn?s("q-item",{attrs:{clickable:""},on:{click:function(t){e.openLesson=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"folder_open"}})],1),s("q-item-section",[s("q-item-label",[e._v("Open Lesson")])],1)],1):e._e(),s("q-separator"),e.loggedIn?s("q-item",{attrs:{clickable:""},on:{click:e.logout}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"logout"}})],1),s("q-item-section",[s("q-item-label",[e._v("Log out")])],1)],1):e._e(),e.loggedIn?e._e():s("q-item",{attrs:{clickable:""},on:{click:function(t){e.loginDialog=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"login"}})],1),s("q-item-section",[s("q-item-label",[e._v("Log in")])],1)],1)],1)],1),s("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.openLesson,callback:function(t){e.openLesson=t},expression:"openLesson"}},[s("q-card",[s("q-card-section",{staticClass:"q-pt-md text-center text-h6"},[e._v("\n        Open Lesson\n        "),s("q-separator")],1),s("q-card-section",[s("div",[s("q-list",[s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[s("q-item-section",{attrs:{avatar:""}},[s("q-radio",{attrs:{val:"missing"},on:{input:e.changedLessonType},model:{value:e.lessonType,callback:function(t){e.lessonType=t},expression:"lessonType"}})],1),s("q-item-section",[s("q-item-label",[e._v("Missing")]),s("q-item-label",{attrs:{caption:""}},[e._v("Lessons in\n                  "),s("a",{attrs:{href:"https://github.com/GospelSounders/all-pdf-lessons-in-pdf",target:"_blank"}},[e._v("pdf format")]),e._v("\n                  which have not been uploaded to\n                  "),s("a",{attrs:{href:"https://sabbathschool.gospelsounders.org/1888-1890/1890/quarter4",target:"_blank"}},[e._v("the site.")])])],1)],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[s("q-item-section",{attrs:{avatar:""}},[s("q-radio",{attrs:{val:"existing"},on:{input:e.changedLessonType},model:{value:e.lessonType,callback:function(t){e.lessonType=t},expression:"lessonType"}})],1),s("q-item-section",[s("q-item-label",[e._v("Existing")]),s("q-item-label",{attrs:{caption:""}},[e._v("Lessons in which have been uploaded to\n                  "),s("a",{attrs:{href:"https://sabbathschool.gospelsounders.org/1888-1890/1890/quarter4",target:"_blank"}},[e._v("the site.")])])],1)],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{tag:"label"}},[s("q-item-section",{attrs:{avatar:""}},[s("q-radio",{attrs:{val:"all"},on:{input:e.changedLessonType},model:{value:e.lessonType,callback:function(t){e.lessonType=t},expression:"lessonType"}})],1),s("q-item-section",[s("q-item-label",[e._v("All")]),s("q-item-label",{attrs:{caption:""}},[e._v("All Lessons available in\n                  "),s("a",{attrs:{href:"https://github.com/GospelSounders/all-pdf-lessons-in-pdf",target:"_blank"}},[e._v("pdf format.")])])],1)],1)],1)],1)]),s("q-card-section",[s("q-form",{staticClass:"q-gutter-md text-white",on:{submit:e.onSubmitOpenLesson,reset:e.onResetgtKey}},[s("q-select",{attrs:{clearable:"","use-input":"",filled:"",options:e.lessonsToOpen,label:"File","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please select file"}]},on:{filter:e.filterFn},model:{value:e.selectedLesson,callback:function(t){e.selectedLesson=t},expression:"selectedLesson"}}),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),s("q-btn",{attrs:{flat:"",label:"Ok",color:"primary",type:"submit"}})],1)],1)],1)],1)],1),s("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.loginDialog,callback:function(t){e.loginDialog=t},expression:"loginDialog"}},[s("q-card",[s("q-card-section",{staticClass:"q-pt-none text-center text-h6"},[e._v("\n        Enter Key\n      ")]),s("q-card-actions",{attrs:{align:"right"}},[s("q-form",{staticClass:"q-gutter-md text-white",on:{submit:e.onSubmitgtKey,reset:e.onResetgtKey}},[s("q-input",{attrs:{filled:"",type:"password",label:"Github Key","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your key"}],"error-message":e.gtKeyErrorMessage},model:{value:e.gkKey,callback:function(t){e.gkKey=t},expression:"gkKey"}}),s("div",{staticClass:"float-right"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),s("q-btn",{attrs:{flat:"",label:"Ok",type:"submit",color:"primary"}})],1)],1)],1)],1)],1),s("q-page-container",[s("q-page",{staticClass:"full-height"},[s("iframe",{ref:"pageEditor",staticStyle:{width:"100%",position:"absolute",height:"100%",border:"0px"},attrs:{src:"/#/blank"}})]),s("q-page",{staticClass:"full-height"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.pageEditorText,expression:"pageEditorText"}],ref:"pageEditorText",staticStyle:{width:"100%",position:"absolute",height:"100%",border:"0px"},domProps:{value:e.pageEditorText},on:{input:function(t){t.target.composing||(e.pageEditorText=t.target.value)}}})]),s("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[s("q-fab",{ref:"fabs",attrs:{"vertical-actions-align":"right",color:"secondary",glossy:"",icon:"keyboard_arrow_up",direction:"up"}},[s("q-fab-action",{attrs:{"label-position":"left",label:"Delete Page"},on:{click:e.deletePage}}),s("q-fab-action",{attrs:{"label-position":"left",label:"Detect Paragraphs"},on:{click:e.detectParagraphs}}),s("q-fab-action",{attrs:{"label-position":"left",label:"Delete Headers"},on:{click:e.deleteHeaders}})],1)],1),s("q-page-sticky",{attrs:{position:"bottom-left",offset:[18,18]}},[s("q-btn",{attrs:{round:"",color:"primary",icon:"save"},on:{click:e.saveExtractedFile}})],1),s("q-page-sticky",{attrs:{position:"right",offset:[18,18]}},[s("q-btn",{attrs:{round:"",color:"primary",icon:"navigate_next"},on:{click:e.gotoNextPage}})],1),s("q-page-sticky",{attrs:{position:"left",offset:[18,18]}},[s("q-btn",{attrs:{round:"",color:"primary",icon:"navigate_before"},on:{click:e.gotoPreviousPage}})],1)],1)],1)},a=[],i=s("2d91"),o=i["a"],l=s("2877"),r=s("4d5a"),c=s("e359"),g=s("65c6"),p=s("9c40"),d=s("6ac5"),h=s("9404"),u=s("1c1c"),m=s("66e5"),f=s("4074"),b=s("0016"),y=s("0170"),q=s("eb85"),w=s("24e8"),v=s("f09f"),L=s("a370"),k=s("3786"),x=s("0378"),C=s("ddd8"),$=s("4b7e"),T=s("27f9"),E=s("09e3"),P=s("9989"),B=s("de5e"),O=s("c294"),S=s("72db"),_=s("714f"),N=s("7f67"),R=s("eebe"),Q=s.n(R),I=Object(l["a"])(o,n,a,!1,null,null,null);t["default"]=I.exports;Q()(I,"components",{QLayout:r["a"],QHeader:c["a"],QToolbar:g["a"],QBtn:p["a"],QToolbarTitle:d["a"],QDrawer:h["a"],QList:u["a"],QItem:m["a"],QItemSection:f["a"],QIcon:b["a"],QItemLabel:y["a"],QSeparator:q["a"],QDialog:w["a"],QCard:v["a"],QCardSection:L["a"],QRadio:k["a"],QForm:x["a"],QSelect:C["a"],QCardActions:$["a"],QInput:T["a"],QPageContainer:E["a"],QPage:P["a"],QPageSticky:B["a"],QFab:O["a"],QFabAction:S["a"]}),Q()(I,"directives",{Ripple:_["a"],ClosePopup:N["a"]})}}]);